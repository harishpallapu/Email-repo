pipeline {
    agent any

    stages {
        stage('source code checkout') {
            steps {
				sh 'rm -rf *'
                checkout([$class: 'GitSCM', branches: [[name: '*/master']], extensions: [], userRemoteConfigs: [[url: 'https://github.com/harishpallapu/SourceCode_SAST.git']]])
				sh 'git clone https://github.com/harishpallapu/sonarqube-scanner-scripts.git'
            }
        }
        stage('SAST analasys') {
            steps {
				sh 'cp -r sonarqube-scanner-scripts/* .'
				sh './sonar-scanner-4.6.2.2472-linux/bin/sonar-scanner'
				sh 'ls -al'
				sh 'cat .scannerwork/report-task.txt  | mail -s "build-no-${BUILD_NUMBER}-reports" nihas0505@gmail.com'
            }
        }
        stage('SCA') {
            steps {
				sh 'echo sca stage'
            }
        }

        stage('jmeter') {
            steps {
	    			sh 'pwd'
				sh 'ls -al'
				sh 'git clone https://github.com/harishpallapu/folder.git'
				sh '''cd folder
					chmod 777 -R *
					./apache-jmeter-5.4.1/apache-jmeter-5.4.1/bin/jmeter -n -t OnlineShop_1.jmx -l OnlineShop_result_${BUILD_NUMBER}.jtl -e -o OnlineShop_${BUILD_NUMBER}.html 
					zip OnlineShop_${BUILD_NUMBER}.html/* jmeterreport.zip
					echo please checkjemeter report html file attachment  | mail -s "jmeter-build-no-${BUILD_NUMBER}-reports" nihas0505@gmail.com -A jmeterreport.zip'''
				
            }
        }
	stage('upload reports to github') {
            steps {
				sh 'pwd'
				sh 'git clone https://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@github.com/harishpallapu/test-reports.git'
				sh 'ls'
            }
        }
    }
}
